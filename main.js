// Generated by CoffeeScript 1.6.3
(function() {
  window.addEventListener('load', function() {
    var bc, canvas, draw, drawBox, model, mouse, over;
    canvas = autoResize(document.getElementById('editor'));
    bc = canvas.getContext('2d');
    model = list(text("define"), list(text("factorial"), text("n")), cr(), list(text("if"), list(text("="), text("n"), text("0")), text("1"), cr(), list(text("*"), text("n"), list(text("factorial"), list(text("-"), text("n"), text("1"))))));
    mouse = mouseInput(canvas);
    window.model = model;
    keyboardEvents(canvas, function(keyCode, text) {
      return console.log(keyCode, text);
    });
    over = null;
    canvas.addEventListener('mousedown', function() {
      var lb;
      if (over != null) {
        lb = listbuffer(cr(), over);
        lb.link = over;
        return model.put(model.length, lb);
      } else {
        lb = listbuffer(cr(), text("LISP"));
        return model.put(model.length, lb);
      }
    });
    draw = function() {
      bc.fillStyle = "#aaa";
      bc.fillRect(0, 0, canvas.width, canvas.height);
      bc.textBaseline = "middle";
      model.layout(bc);
      model.x = 50;
      model.y = 50;
      over = model.mousemotion.apply(model, mouse.point);
      model.draw(bc);
      bc.fillText("click the screen or contents to test PUT -commands", 50, 10);
      return requestAnimationFrame(draw);
    };
    drawBox = function(x, y, w, h) {
      bc.beginPath();
      bc.rect(x, y, w, h);
      bc.fill();
      return bc.stroke();
    };
    return draw();
  });

}).call(this);
